<!doctype html>
<html lang="en" dir="ltr" class="blog-wrapper blog-tags-post-list-page plugin-blog plugin-id-default">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.2.0">
<title data-rh="true">4 posts tagged with &quot;typescript&quot; | TypeScript Guidelines</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="http://unional.github.io/typescript-guidelines/blog/tags/typescript"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" property="og:title" content="4 posts tagged with &quot;typescript&quot; | TypeScript Guidelines"><meta data-rh="true" name="docusaurus_tag" content="blog_tags_posts"><meta data-rh="true" name="docsearch:docusaurus_tag" content="blog_tags_posts"><link data-rh="true" rel="icon" href="/typescript-guidelines/img/favicon.ico"><link data-rh="true" rel="canonical" href="http://unional.github.io/typescript-guidelines/blog/tags/typescript"><link data-rh="true" rel="alternate" href="http://unional.github.io/typescript-guidelines/blog/tags/typescript" hreflang="en"><link data-rh="true" rel="alternate" href="http://unional.github.io/typescript-guidelines/blog/tags/typescript" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/typescript-guidelines/blog/rss.xml" title="TypeScript Guidelines RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/typescript-guidelines/blog/atom.xml" title="TypeScript Guidelines Atom Feed"><link rel="stylesheet" href="/typescript-guidelines/assets/css/styles.2ecf7e1b.css">
<link rel="preload" href="/typescript-guidelines/assets/js/runtime~main.911067f8.js" as="script">
<link rel="preload" href="/typescript-guidelines/assets/js/main.d95017bd.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_NnM2" href="#docusaurus_skipToContent_fallback">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/typescript-guidelines/"><div class="navbar__logo"><img src="/typescript-guidelines/img/logo.svg" alt="TypeScript Guidelines Logo" class="themedImage_HEbR themedImage--light_Ro7w"><img src="/typescript-guidelines/img/logo.svg" alt="TypeScript Guidelines Logo" class="themedImage_HEbR themedImage--dark_SRPJ"></div><b class="navbar__title text--truncate">TypeScript Guidelines</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/typescript-guidelines/blog">Blog</a><a class="navbar__item navbar__link" href="/typescript-guidelines/docs/">Guidelines</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/unional/typescript-guidelines" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_jk1y"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_dnWs colorModeToggle_GeVt"><button class="clean-btn toggleButton_VwXO toggleButtonDisabled_vttZ" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_qLjs"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_SAz3"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_OloH"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_t20v"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_X2nK thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_ZWHL margin-bottom--md">Recent posts</div><ul class="sidebarItemList_PSL4 clean-list"><li class="sidebarItem_ZDVb"><a class="sidebarItemLink_eBnO" href="/typescript-guidelines/blog/2022-tsc-esm-fix">Fixing TypeScript code for ESM with `tsc-esm-fix`</a></li><li class="sidebarItem_ZDVb"><a class="sidebarItemLink_eBnO" href="/typescript-guidelines/blog/2022-migrate-to-esm">Migrating to ESM</a></li><li class="sidebarItem_ZDVb"><a class="sidebarItemLink_eBnO" href="/typescript-guidelines/blog/2022-eslint-plugin-peer-deps">@typescript-eslint/eslint-plugin should be a peer dependency</a></li><li class="sidebarItem_ZDVb"><a class="sidebarItemLink_eBnO" href="/typescript-guidelines/blog/2022-typescript-is-abstraction">TypeScript is ... an abstraction</a></li></ul></nav></aside><main class="col col--7" itemscope="" itemtype="http://schema.org/Blog"><header class="margin-bottom--xl"><h1>4 posts tagged with &quot;typescript&quot;</h1><a href="/typescript-guidelines/blog/tags">View All Tags</a></header><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="title_ExS0" itemprop="headline"><a itemprop="url" href="/typescript-guidelines/blog/2022-tsc-esm-fix">Fixing TypeScript code for ESM with `tsc-esm-fix`</a></h2><div class="container_MdJT margin-vert--md"><time datetime="2022-06-05T00:00:00.000Z" itemprop="datePublished">June 5, 2022</time> · <!-- -->3 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_R5Ec"><div class="avatar margin-bottom--sm"><a href="https://github.com/unional" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://github.com/unional.png" alt="Homa Wong (unional)"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/unional" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Homa Wong (unional)</span></a></div><small class="avatar__subtitle" itemprop="description">Clean Architect</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><p>TypeScript 4.7 is released 🎉!</p><p>The wait is finally over.
You are excited to start your migration.</p><p>So you update your <code>package.json</code>,
update your <code>tsconfig.json</code>,
and volia, you are greeted with a boat load of errors.</p><p>What you need to do is to update your <code>import</code> statements:</p><ul><li>add <code>.js</code> extension for files, or</li><li>add <code>/index.js</code> for folders.</li></ul><p>You can do that manually,
or you can use a tool to help you on that.</p><p>The tool (<a href="https://github.com/antongolub/tsc-esm-fix" target="_blank" rel="noopener noreferrer"><code>tsc-esm-fix</code></a>) is the focus of the topic today.
But before that,
let me highlight a few things about the current state of the <code>type: module</code> support in TypeScript 4.7,
so that you can decide should you take the jump right now,
or should you wait a little bit longer.</p><p>There are four issues that I&#x27;m aware of related to <code>type: module</code>.</p><h2 class="anchor anchorWithStickyNavbar_MUeT" id="the-js-extension-debate">The <code>.js</code> extension debate<a class="hash-link" href="#the-js-extension-debate" title="Direct link to heading">​</a></h2><p>The first one is a debate around the <code>.js</code> extension.</p><p>The take aways are:</p><ul><li><code>.js</code> is artifical, pointing to a non-existing file</li><li>TypeScript team do not want to rewrite JS code</li><li>NodeJS needs extra tricks to detect the source type</li></ul><p>You can read about the detail here:</p><ul><li><a href="https://github.com/microsoft/TypeScript/issues/49083" target="_blank" rel="noopener noreferrer">https://github.com/microsoft/TypeScript/issues/49083</a></li><li><a href="https://github.com/microsoft/TypeScript/issues/16577#issuecomment-754941937" target="_blank" rel="noopener noreferrer">https://github.com/microsoft/TypeScript/issues/16577#issuecomment-754941937</a></li></ul><h2 class="anchor anchorWithStickyNavbar_MUeT" id="broken-source-map">broken source map<a class="hash-link" href="#broken-source-map" title="Direct link to heading">​</a></h2><p>The second one is that source map is currently broken.</p><p>If your code will be used in the browser,
you need to weight that in.</p><p>You can read about the detail here: <a href="https://github.com/microsoft/TypeScript/issues/49335" target="_blank" rel="noopener noreferrer">https://github.com/microsoft/TypeScript/issues/49335</a></p><h2 class="anchor anchorWithStickyNavbar_MUeT" id="ts-loader-workaround">ts-loader workaround<a class="hash-link" href="#ts-loader-workaround" title="Direct link to heading">​</a></h2><p>The third one is that currently <a href="https://github.com/TypeStrong/ts-loader" target="_blank" rel="noopener noreferrer"><code>ts-loader</code></a> does not support ESM module out of the box.</p><p>You have to do two things.</p><ol><li>use the <code>NormalModuleReplacmentPlugin</code>:</li></ol><div class="language-js codeBlockContainer_SpEH theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_fJUE"><pre tabindex="0" class="prism-code language-js codeBlock_DDXr thin-scrollbar"><code class="codeBlockLines__few"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">plugins</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">NormalModuleReplacementPlugin</span><span class="token punctuation" style="color:#393A34">(</span><span class="token regex regex-delimiter" style="color:#36acaa">/</span><span class="token regex regex-source language-regex" style="color:#36acaa">.js$</span><span class="token regex regex-delimiter" style="color:#36acaa">/</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">resource</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token regex regex-delimiter" style="color:#36acaa">/</span><span class="token regex regex-source language-regex" style="color:#36acaa">node_modules</span><span class="token regex regex-delimiter" style="color:#36acaa">/</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">test</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">resource</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">context</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      resource</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">request</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> resource</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">request</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">replace</span><span class="token punctuation" style="color:#393A34">(</span><span class="token regex regex-delimiter" style="color:#36acaa">/</span><span class="token regex regex-source language-regex" style="color:#36acaa">.js$</span><span class="token regex regex-delimiter" style="color:#36acaa">/</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup_NpOT"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_mmnY" aria-hidden="true"><svg class="copyButtonIcon_xCIk" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_r0l2" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="2"><li>Do not use <code>transpileOnly: true</code>. It does not work.</li></ol><p>If I have time, I might dig in to help <a href="https://github.com/TypeStrong/ts-loader" target="_blank" rel="noopener noreferrer"><code>ts-loader</code></a> about this,
but not sure when I&#x27;ll be able to do that.</p><p>You can read about the detail heere: <a href="https://github.com/TypeStrong/ts-loader/issues/1463" target="_blank" rel="noopener noreferrer">https://github.com/TypeStrong/ts-loader/issues/1463</a></p><h2 class="anchor anchorWithStickyNavbar_MUeT" id="jest-esm-workaround">jest ESM workaround<a class="hash-link" href="#jest-esm-workaround" title="Direct link to heading">​</a></h2><p>The last one is an outstanding one,
that <a href="http://facebook.github.io/jest/" target="_blank" rel="noopener noreferrer"><code>jest</code></a> does not have native support of ESM.</p><p>Meaning when you use <a href="https://kulshekhar.github.io/ts-jest/" target="_blank" rel="noopener noreferrer"><code>ts-jest</code></a>, you also need to use <a href="https://github.com/facebook/jest#using-babel" target="_blank" rel="noopener noreferrer"><code>babel-jest</code></a> to transpile dependencies within <code>node_modules</code>.</p><p>Here is a nutshell of what you need to do:</p><div class="language-js codeBlockContainer_SpEH theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_fJUE"><pre tabindex="0" class="prism-code language-js codeBlock_DDXr thin-scrollbar"><code class="codeBlockLines__few"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// jest.config.mjs</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword module" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword module" style="color:#00009f">default</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">preset</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;ts-jest/presets/default-esm&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">globals</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string-property property" style="color:#36acaa">&#x27;ts-jest&#x27;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token literal-property property" style="color:#36acaa">useESM</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">moduleNameMapper</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// remove the phantom `.js` extension</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string-property property" style="color:#36acaa">&#x27;^(\\.{1,2}/.*)\\.js$&#x27;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;$1&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// If dependency doing `import ... from &#x27;#&lt;pkg&gt;&#x27;.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// e.g. `chalk` has this: `import ... form &#x27;#ansi-styles&#x27;`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string-property property" style="color:#36acaa">&#x27;#(.*)&#x27;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;&lt;rootDir&gt;/node_modules/$1&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">transformIgnorePatterns</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// Need to MANUALLY identify each ESM package, one by one</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&#x27;node_modules/(?!(@unional\\fixture|chalk)/)&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">transform</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string-property property" style="color:#36acaa">&#x27;^.+\\.(js|jsx|mjs)$&#x27;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;babel-jest&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup_NpOT"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_mmnY" aria-hidden="true"><svg class="copyButtonIcon_xCIk" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_r0l2" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>You can find related information here: <a href="https://dev.to/steveruizok/jest-and-esm-cannot-use-import-statement-outside-a-module-4mmj" target="_blank" rel="noopener noreferrer">https://dev.to/steveruizok/jest-and-esm-cannot-use-import-statement-outside-a-module-4mmj</a></p><h2 class="anchor anchorWithStickyNavbar_MUeT" id="tsc-esm-fix"><code>tsc-esm-fix</code><a class="hash-link" href="#tsc-esm-fix" title="Direct link to heading">​</a></h2><p>Now, if you decide to move ahead,
then you can use <a href="https://github.com/antongolub/tsc-esm-fix" target="_blank" rel="noopener noreferrer"><code>tsc-esm-fix</code></a> to help you.</p><p>I used it to help me migrating <a href="https://github.com/unional/type-plus" target="_blank" rel="noopener noreferrer"><code>type-plus</code></a>, which has 140+ files.
I&#x27;m using it for other packages as I&#x27;m writing this blog.</p><p>I have discovered a few bugs and <a href="https://github.com/antongolub" target="_blank" rel="noopener noreferrer">@antongolub</a> is very quick to fix them.
Go to the repo and give it a star ⭐!</p><p>The easiest way to use it is through <code>npx</code> or <code>yarn dlx</code>:</p><div class="language-sh codeBlockContainer_SpEH theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_fJUE"><pre tabindex="0" class="prism-code language-sh codeBlock_DDXr thin-scrollbar"><code class="codeBlockLines__few"><span class="token-line" style="color:#393A34"><span class="token plain">npx tsc-esm-fix --src=&lt;src&gt; --ext=&#x27;.js&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># or</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">yarn dlx tsc-esm-fix --src=&lt;src&gt; --ext=&#x27;.js&#x27;</span><br></span></code></pre><div class="buttonGroup_NpOT"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_mmnY" aria-hidden="true"><svg class="copyButtonIcon_xCIk" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_r0l2" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>For <a href="https://github.com/unional/type-plus" target="_blank" rel="noopener noreferrer"><code>type-plus</code></a>, since I put the source code under the <code>ts</code> folder,
so the command is:</p><div class="language-sh codeBlockContainer_SpEH theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_fJUE"><pre tabindex="0" class="prism-code language-sh codeBlock_DDXr thin-scrollbar"><code class="codeBlockLines__few"><span class="token-line" style="color:#393A34"><span class="token plain">npx tsc-esm-fix --src=ts --ext=&#x27;.js&#x27;</span><br></span></code></pre><div class="buttonGroup_NpOT"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_mmnY" aria-hidden="true"><svg class="copyButtonIcon_xCIk" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_r0l2" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>If you put your source code under the typical <code>src</code> folder,
then the command is:</p><div class="language-sh codeBlockContainer_SpEH theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_fJUE"><pre tabindex="0" class="prism-code language-sh codeBlock_DDXr thin-scrollbar"><code class="codeBlockLines__few"><span class="token-line" style="color:#393A34"><span class="token plain">npx tsc-esm-fix --src=src --ext=&#x27;.js&#x27;</span><br></span></code></pre><div class="buttonGroup_NpOT"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_mmnY" aria-hidden="true"><svg class="copyButtonIcon_xCIk" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_r0l2" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Happy Coding, 🧑‍💻</p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_dJql padding--none margin-left--sm"><li class="tag_HOzk"><a class="tag__MrZ tagRegular_NzWM" href="/typescript-guidelines/blog/tags/typescript">typescript</a></li><li class="tag_HOzk"><a class="tag__MrZ tagRegular_NzWM" href="/typescript-guidelines/blog/tags/esm">ESM</a></li></ul></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="title_ExS0" itemprop="headline"><a itemprop="url" href="/typescript-guidelines/blog/2022-migrate-to-esm">Migrating to ESM</a></h2><div class="container_MdJT margin-vert--md"><time datetime="2022-05-17T00:00:00.000Z" itemprop="datePublished">May 17, 2022</time> · <!-- -->3 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_R5Ec"><div class="avatar margin-bottom--sm"><a href="https://github.com/unional" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://github.com/unional.png" alt="Homa Wong (unional)"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/unional" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Homa Wong (unional)</span></a></div><small class="avatar__subtitle" itemprop="description">Clean Architect</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><p>ESM, or ECMAScript Module, was original part of the ES6/ES2015 specification.
It turned out to be difficult to implement and was pulled from the core specification at the last minute.</p><p>There were many discussions and argument about it.
At one point, it almost falls apart because NodeJS couldn&#x27;t get to a good design to get CommonJS and ESM to co-exist.</p><p>Fast-forward a few years, ESM is mature enough to be used on both NodeJS and browsers.</p><p>By now, I&#x27;m pretty sure you have heard of it already.</p><p>But for people who write code in TypeScript, while we use <code>import</code> and <code>export</code> for a very long time,
we were not able to publish the code as ESM.</p><p>What&#x27;s worse is that, some JavaScript code moved on to ESM and the new module package in NodeJS,
and TypeScript code cannot consume them.</p><p>So the TypeScript code is being left behind.</p><p>TypeScript 4.5 planned to support the new module system,
but the support was pulled due to some cases were not resolved.</p><p>While it was heartbreaking when the announcement was made,
I completely understand and support the rationale behind it.</p><p>It would be much worse if the solution is half-baked and released to the world.
The damage it causes could be devastating.</p><p>TypeScript 4.7 is trying to provide the support again,
and hopefully it&#x27;s here to stay.</p><h2 class="anchor anchorWithStickyNavbar_MUeT" id="the-big-migration">The big migration<a class="hash-link" href="#the-big-migration" title="Direct link to heading">​</a></h2><p>So how to migrate your code to ESM?</p><p>Upgrade TypeScript:</p><div class="language-sh codeBlockContainer_SpEH theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_fJUE"><pre tabindex="0" class="prism-code language-sh codeBlock_DDXr thin-scrollbar"><code class="codeBlockLines__few"><span class="token-line" style="color:#393A34"><span class="token plain">npm install --dev typescript@rc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">yarn add -D typescript@rc</span><br></span></code></pre><div class="buttonGroup_NpOT"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_mmnY" aria-hidden="true"><svg class="copyButtonIcon_xCIk" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_r0l2" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>(or <code>typescript</code> without <code>@rc</code> when 4.7 is released).</p><p>Update your <code>package.json</code> to:</p><div class="language-json codeBlockContainer_SpEH theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_fJUE"><pre tabindex="0" class="prism-code language-json codeBlock_DDXr thin-scrollbar"><code class="codeBlockLines__few"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;type&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;module&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;exports&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;.&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">&quot;import&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;default&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;&lt;path to main&gt;&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;types&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;&lt;path to d.ts&gt;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup_NpOT"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_mmnY" aria-hidden="true"><svg class="copyButtonIcon_xCIk" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_r0l2" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>In <a href="https://devblogs.microsoft.com/typescript/announcing-typescript-4-7-rc/" target="_blank" rel="noopener noreferrer">TypeScript 4.7</a> announcement and other places mentioned you can provide fallback for CommonJS,
but in general it could cause problems as that will increase the chance of having multiple copies of your library exist in runtime.</p><p>Update your <code>import</code> statements to add <code>.js</code> extension.
e.g.:</p><div class="language-ts codeBlockContainer_SpEH theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_fJUE"><pre tabindex="0" class="prism-code language-ts codeBlock_DDXr thin-scrollbar"><code class="codeBlockLines__few"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// import { foo } from &#x27;./foo&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> foo </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;./foo.js&#x27;</span><br></span></code></pre><div class="buttonGroup_NpOT"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_mmnY" aria-hidden="true"><svg class="copyButtonIcon_xCIk" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_r0l2" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Update your project files from <code>.js</code> to either <code>.cjs</code> or <code>.mjs</code>.</p><p>When you set the package to use <code>&quot;type&quot;: &quot;module&quot;</code>,
Your project files such as <code>jest.config.js</code> and <code>babel.config.js</code> becomes ambiguous,
and you have to update the file extension to reflect if the file is a CommonJS or ESM file.</p><p>Some tools might not work with the new module format.
You have to disable them for now.</p><p>To me, I found that <a href="https://github.com/ai/size-limit" target="_blank" rel="noopener noreferrer"><code>size-limit</code></a> does not support it yet.</p><p>Also, I found that I can&#x27;t import the default export from TypeScript package transpiled to CommonJS.</p><p>Don&#x27;t know if that is by design or it is a bug yet.</p><p>You can take a look at the <a href="https://github.com/unional/global-store/tree/esm" target="_blank" rel="noopener noreferrer"><code>global-store</code> PR</a> as an example.</p><p>Happy Coding, 🧑‍💻</p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_dJql padding--none margin-left--sm"><li class="tag_HOzk"><a class="tag__MrZ tagRegular_NzWM" href="/typescript-guidelines/blog/tags/typescript">typescript</a></li><li class="tag_HOzk"><a class="tag__MrZ tagRegular_NzWM" href="/typescript-guidelines/blog/tags/esm">ESM</a></li></ul></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="title_ExS0" itemprop="headline"><a itemprop="url" href="/typescript-guidelines/blog/2022-eslint-plugin-peer-deps">@typescript-eslint/eslint-plugin should be a peer dependency</a></h2><div class="container_MdJT margin-vert--md"><time datetime="2022-05-15T00:00:00.000Z" itemprop="datePublished">May 15, 2022</time> · <!-- -->One min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_R5Ec"><div class="avatar margin-bottom--sm"><a href="https://github.com/unional" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://github.com/unional.png" alt="Homa Wong (unional)"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/unional" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Homa Wong (unional)</span></a></div><small class="avatar__subtitle" itemprop="description">Clean Architect</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><p>Recently I run into this problem:</p><div class="language-sh codeBlockContainer_SpEH theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_fJUE"><pre tabindex="0" class="prism-code language-sh codeBlock_DDXr thin-scrollbar"><code class="codeBlockLines__few"><span class="token-line" style="color:#393A34"><span class="token plain">ESLint couldn&#x27;t determine the plugin &quot;@typescript-eslint&quot; uniquely.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- ...\node_modules\@typescript-eslint\eslint-plugin\dist\index.js (loaded in &quot;.eslintrc.json&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- ...\node_modules\eslint-config-react-app\node_modules\@typescript-eslint\eslint-plugin\dist\index.js (loaded in &quot;.eslintrc.json » eslint-config-react-app#overrides[0]&quot;)</span><br></span></code></pre><div class="buttonGroup_NpOT"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_mmnY" aria-hidden="true"><svg class="copyButtonIcon_xCIk" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_r0l2" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>It is caused by <a href="https://github.com/facebook/create-react-app/tree/main/packages/eslint-config-react-app" target="_blank" rel="noopener noreferrer">eslint-config-react-app</a> using <a href="https://github.com/typescript-eslint/typescript-eslint/tree/main/packages/eslint-plugin" target="_blank" rel="noopener noreferrer">@typescript-eslint/eslint-plugin</a> as a <code>dependency</code> instead of a <code>peer dependency</code>.</p><p>Here is the <a href="https://github.com/facebook/create-react-app/issues/12400" target="_blank" rel="noopener noreferrer">GitHub issue</a> in <a href="https://github.com/facebook/create-react-app/tree/main/packages/eslint-config-react-app" target="_blank" rel="noopener noreferrer">eslint-config-react-app</a> (also <a href="https://github.com/facebook/create-react-app/issues/11828" target="_blank" rel="noopener noreferrer">here</a>).</p><h2 class="anchor anchorWithStickyNavbar_MUeT" id="plugin-and-dependency">Plugin and dependency<a class="hash-link" href="#plugin-and-dependency" title="Direct link to heading">​</a></h2><p>The problem is when one plugin uses another plugin,
it should always declare the dependency as a <code>peer dependency</code>.</p><p>The reason is simple.</p><p>The host application (ESLint in this case) controls and loads its plugins.
If the host application is not designed to support loading multiple versions of the same plugin at the same time,
which most of them don&#x27;t, then the result is an undefined behavior.</p><p>That&#x27;s why ESLint plainly detects and disallows it.</p><p>It also mentioned it in <a href="https://eslint.org/docs/developer-guide/shareable-configs#publishing-a-shareable-config" target="_blank" rel="noopener noreferrer">its doc</a>.</p><p>Yes, that means the consuming repository needs to add the dependency themselves.
Any version incompatibility in the dependency graph would lead to the <a href="https://rushjs.io/pages/advanced/npm_doppelgangers/" target="_blank" rel="noopener noreferrer">doppelgängers</a> problem.</p><p>That is an inherited problem of NodeJS resolution algorithm, and is a topic for another day.</p><p>Happy coding, 🧑‍💻</p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_dJql padding--none margin-left--sm"><li class="tag_HOzk"><a class="tag__MrZ tagRegular_NzWM" href="/typescript-guidelines/blog/tags/typescript">typescript</a></li><li class="tag_HOzk"><a class="tag__MrZ tagRegular_NzWM" href="/typescript-guidelines/blog/tags/eslint">eslint</a></li><li class="tag_HOzk"><a class="tag__MrZ tagRegular_NzWM" href="/typescript-guidelines/blog/tags/typescript-eslint">@typescript-eslint</a></li></ul></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="title_ExS0" itemprop="headline"><a itemprop="url" href="/typescript-guidelines/blog/2022-typescript-is-abstraction">TypeScript is ... an abstraction</a></h2><div class="container_MdJT margin-vert--md"><time datetime="2022-05-14T00:00:00.000Z" itemprop="datePublished">May 14, 2022</time> · <!-- -->4 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_R5Ec"><div class="avatar margin-bottom--sm"><a href="https://github.com/unional" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://github.com/unional.png" alt="Homa Wong (unional)"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/unional" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Homa Wong (unional)</span></a></div><small class="avatar__subtitle" itemprop="description">Clean Architect</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><p><a href="https://devblogs.microsoft.com/typescript/announcing-typescript-4-7-rc/" target="_blank" rel="noopener noreferrer">TypeScript 4.7</a> is just around the corner.</p><p>I feel like it is a good time for me to update this TypeScript guidelines
with what I have learn over the years and how am I using it nowadays.</p><p>As you can see,
I&#x27;ve reorganized the repository and added this GitHub page
to make it easier to share the knowledge.</p><p>In these blog posts,
I&#x27;m going to share the bits and tips that I learned every day.
Eventually this information will be incorporated into the guidelines.</p><p>To kick things off, I&#x27;m going to talk about what TypeScript is in 2022?</p><p>No no, not about the history of TypeScript.</p><p>It&#x27;s about how I look at TypeScript and how I use it.</p><p>It&#x27;s about when I follow the rules and when I break them.</p><blockquote><p>I know all the rules, and then I know how to break &#x27;em</p></blockquote><h2 class="anchor anchorWithStickyNavbar_MUeT" id="typescript-is-an-abstraction">TypeScript is an abstraction<a class="hash-link" href="#typescript-is-an-abstraction" title="Direct link to heading">​</a></h2><p>Programming language is an abstraction.</p><p>The abstraction I&#x27;m talking about is not the abstraction of defining an interface or class or inheritance.</p><p>It&#x27;s about the code you wrote, the text you typed in the <code>.ts</code> or <code>.tsx</code> file.</p><p>It is an abstraction over the actual binary code executed by the JavaScript engine.</p><p>A good abstraction emphasizes the important but sometimes has a cost of skipping over some details.</p><p>For example, the digital zeros and ones are an abstraction over the analog electrical currents.</p><p>Most of the time, at least in the sense of modern computing,
missing the details on the different levels of electrical currents is a good thing.
And we as a programmer don&#x27;t ever need to think about it.</p><p>But to the eye of hardware engineer,
it is not something they can ignore because there are physical rules they have to follow,
and there are actual consequences when putting two wires too close to each other.</p><p>The abstraction of programming language is the same.
It is good for most cases, but at some point it will start to breakdown.</p><p><a href="https://www.rust-lang.org/" target="_blank" rel="noopener noreferrer">rust</a> is a good example of this.
Its ownership model guarantee memory-safety and thread-safety.
But there are rare cases you need to break the rules thus there is a <code>unsafe</code> keyword for it.</p><p>For <a href="https://www.typescriptlang.org/" target="_blank" rel="noopener noreferrer">TypeScript</a>, it is not designed to be a 100% sounded language.
That means you will run into those &quot;rare&quot; cases a lot more often.</p><p>You can learn more about soundness <a href="https://www.typescriptlang.org/docs/handbook/type-compatibility.html#a-note-on-soundness" target="_blank" rel="noopener noreferrer">here</a> and <a href="https://www.typescriptlang.org/play?strictFunctionTypes=false#example/soundness" target="_blank" rel="noopener noreferrer">here</a>.</p><h2 class="anchor anchorWithStickyNavbar_MUeT" id="conclusion">Conclusion<a class="hash-link" href="#conclusion" title="Direct link to heading">​</a></h2><p>So what should you do? Embrace it.</p><p>The <code>unsafe</code> keyword in <a href="https://www.typescriptlang.org/" target="_blank" rel="noopener noreferrer">TypeScript</a> is <code>any</code>.
While you should avoid using <code>any</code> in most cases,
it is often enough that your tool chain should not prevent or punish you from using it.</p><p>You might think,</p><blockquote><p>&quot;hey, I&#x27;m working in a team and I don&#x27;t want my team members who are less familiar with TypeScript to abuse the usage of <code>any</code>.&quot;</p></blockquote><p>Yes, that is a legit concern,
and you can make your own judgement for your circumstances.</p><p>My personal experience is that the number of times I have to break the rules are common enough that making exceptions for the tools (e.g. adding <code>// eslint ignore</code> comments) clutter the code and make the code harder to read.</p><p>My approach is to rely on unit tests and code reviews to make sure the usage of <code>any</code> are in check.</p><p>Also, defining the correct type is not always easy and can take significant amount of time.
If you are working under a schedule, you might not have time to do that.</p><p>Another point to make is that since <a href="https://www.typescriptlang.org/" target="_blank" rel="noopener noreferrer">TypeScript</a> is constantly improving,
if you build some complex types, it might work in one version and break in another version.</p><p>ASK ME HOW I KNOW IT.</p><p>Of course, I&#x27;m not saying allowing your code litters with <code>any</code> and call it a day.
You should keep track on those usages and clean it up when you get a chance to.</p><p>Converting <code>any</code> back to a proper type improves efficiency.
As that is why we use <a href="https://www.typescriptlang.org/" target="_blank" rel="noopener noreferrer">TypeScript</a>.</p><p>And you may discover some bugs along the way.</p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_dJql padding--none margin-left--sm"><li class="tag_HOzk"><a class="tag__MrZ tagRegular_NzWM" href="/typescript-guidelines/blog/tags/typescript">typescript</a></li></ul></div></footer></article><nav class="pagination-nav" aria-label="Blog list page navigation"></nav></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/typescript-guidelines/docs/">Guidelines</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://discord.gg/RwzcFpN5fv" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_jk1y"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://twitter.com/unional" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_jk1y"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/typescript-guidelines/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/unional/typescript-guidelines" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_jk1y"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2022 by unional</div></div></div></footer></div>
<script src="/typescript-guidelines/assets/js/runtime~main.911067f8.js"></script>
<script src="/typescript-guidelines/assets/js/main.d95017bd.js"></script>
</body>
</html>